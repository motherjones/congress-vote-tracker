/*! Syria Vote - v0.1.0 - 2013-09-06
* https://github.com/motherjones/syria
* Copyright (c) 2013 Mother Jones Data Desk; Licensed MIT */
"use strict";var current_d=199,current_r=234,current_empty=2,total_seats=435,tooltip_template="     <h3>{member}</h3>     <p>Party Affiliation: {party}</p>     <p>{strength} {lean}</p> ",compiled_tooltip=dust.compile(tooltip_template,"tooltip");dust.loadSource(compiled_tooltip);var tooltip_element=jQuery('<div id="tooltip" style="display: none; position: absolute;"><p>text</p></div>');window.onload=function(){jQuery("svg").before(tooltip_element);var t;Tabletop.init({key:public_spreadsheet_url,callback:function(e){var n=t=cleanup_dataset(e);count_whip(n)},simpleSheet:!0}),dataset_times.sort().reverse();for(var e=jQuery("#time_picker"),n=0;dataset_times.length>n;n++){var o,a=dataset_times[n];for(var s in a)o=s;var r=jQuery("<button>"+o+"</button>");(function(t){r.click(function(){count_whip(t)})})(cleanup_dataset(a[o])),e.prepend(r)}jQuery("#current").click(function(){count_whip(t)})};var cleanup_dataset=function(t){for(var e={D:{yes:{strong:[],weak:[]},no:{strong:[],weak:[]},unknown:[],undecided:[]},R:{yes:{strong:[],weak:[]},no:{strong:[],weak:[]},unknown:[],undecided:[]},I:{yes:{strong:[],weak:[]},no:{strong:[],weak:[]},unknown:[],undecided:[]}},n=0,o=0,a=0,s=0;t.length>s;s++){var r=t[s].lean=t[s].undecided?"undecided":t[s].unknown?"unknown":t[s].no||t[s].leanno?"no":"yes",l=t[s].strength=t[s].undecided||t[s].unknown?"":t[s].no||t[s].yes?"strong":"weak";"D"===t[s].party?n++:"R"===t[s].party?o++:"I"===t[s].party&&a++,dust.render("tooltip",t[s],function(e,n){t[s].tooltip=n});var i={name:t[s].member,party:t[s].party,lean:r+l,tooltip:t[s].tooltip};"undecided"===r||"unknown"===r?e[t[s].party][r].push(i):e[t[s].party][r][l].push(i)}return e},count_whip=function(t){for(var e=0,n=t.D.no.strong,o=0;n.length>o;o++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","strongDno "+n[o].name.replace(/\s/,"")),a.setAttribute("data-tooltip",n[o].tooltip)}for(var s=t.D.no.weak,o=0;s.length>o;o++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","weakDno "+s[o].name.replace(/\s/,"")),a.setAttribute("data-tooltip",s[o].tooltip)}for(var r=t.D.undecided,o=0;r.length>o;o++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","d_undecided "+r[o].name.replace(/\s/,"")),a.setAttribute("data-tooltip",r[o].tooltip)}for(var l=t.D.unknown,o=0;l.length>o;o++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","d_unknown "+l[o].name.replace(/\s/,"")),a.setAttribute("data-tooltip",l[o].tooltip)}for(var i=t.D.yes.weak,o=0;i.length>o;o++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","weakDyes "+i[o].name.replace(/\s/,"")),a.setAttribute("data-tooltip",i[o].tooltip)}for(var u=t.D.yes.strong,o=0;u.length>o;o++){var a=document.getElementById("seat"+e);a.setAttribute("class","strongDyes "+e),e++,a.setAttribute("data-tooltip",u[o].tooltip)}document.getElementById("seat"+e).setAttribute("class","empty_seat"),document.getElementById("seat"+e).setAttribute("data-tooltip","Empty Seat"),e++,document.getElementById("seat"+e).setAttribute("class","empty_seat"),document.getElementById("seat"+e).setAttribute("data-tooltip","Empty Seat"),e++;for(var d=t.R.yes.strong,o=0;d.length>o;o++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","strongRyes "+d[o].name.replace(/\s/,"")),a.setAttribute("data-tooltip",d[o].tooltip)}for(var p=t.R.yes.weak,o=0;p.length>o;o++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","weakRyes "+p[o].name.replace(/\s/,"")),a.setAttribute("data-tooltip",p[o].tooltip)}for(var c=y+d.length+p.length,m=t.R.unknown,o=0;m.length>o;o++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","r_unknown "+m[o].name.replace(/\s/,"")),a.setAttribute("data-tooltip",m[o].tooltip+m[o].lean)}for(var g=t.R.undecided,o=0;g.length>o;o++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","r_undecided "+g[o].name.replace(/\s/,"")),a.setAttribute("data-tooltip",g[o].tooltip)}for(var y=c+m.length+g.length,v=t.R.no.weak,o=0;v.length>o;o++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","weakRno "+v[o].name.replace(/\s/,"")),a.setAttribute("data-tooltip",v[o].tooltip)}for(var b=t.R.no.strong,o=0;b.length>o;o++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","strongRno "+b[o].name.replace(/\s/,"")),a.setAttribute("data-tooltip",b[o].tooltip)}jQuery("svg circle").bind("mouseout",function(){tooltip_element.css("display","none")}),jQuery("svg circle").bind("mousemove",function(t){tooltip_element.css("left",t.pageX+10).css("top",t.pageY+10).css("display","block").html(jQuery(this).attr("data-tooltip"))})};