/*! Syria Vote - v0.1.0 - 2013-09-07
* https://github.com/motherjones/syria
* Copyright (c) 2013 Mother Jones Data Desk; Licensed MIT */
"use strict";var current_d=199,current_r=234,current_empty=2,total_seats=435,showing_d_only=!1,showing_r_only=!1,displayed_leaning,play_time,compiled_tooltip=dust.compile(tooltip_template,"tooltip");dust.loadSource(compiled_tooltip);var tooltip_element=jQuery('<div id="tooltip" style="display: none; position: absolute;"><p>text</p></div>');window.onload=function(){jQuery("svg").before(tooltip_element),dataset_times.sort();for(var e=[],t=0;dataset_times.length>t;t++){var n,a=dataset_times[t];for(var o in a)n=o;e.push(cleanup_dataset(a[n]))}var s=jQuery("#time_picker"),r="Latest vote tally",l=jQuery('<label id="time_picker_label">'+r+"</label>");s.after(l),s.noUiSlider({range:[0,dataset_times.length],handles:1,start:[dataset_times.length],step:1,slide:function(){var t=$(this).val();count_whip(e[t]),displayed_leaning=e[t];var n=t===dataset_times.length?r:function(){for(var e in dataset_times[t])return e};l.text(n)}}),play_time=function(t){t===void 0&&(t=s.val()+1),s.val(t),count_whip(e[t]),displayed_leaning=e[t];var n=t===dataset_times.length?r:function(){for(var e in dataset_times[t])return e};l.text(n),dataset_times.length>t?setTimeout(function(){play_time()},1e3):jQuery("#play_times").removeClass("selected")},jQuery("#play_times").click(function(){return jQuery("#play_times").addClass("selected"),play_time(0),!1}),Tabletop.init({key:public_spreadsheet_url,callback:function(t){var n=displayed_leaning=cleanup_dataset(t);e.push(n),count_whip(n)},simpleSheet:!0}),jQuery("svg circle").bind("mouseout",function(){tooltip_element.css("display","none")}),jQuery("svg circle").bind("mousemove",function(e){tooltip_element.css("left",e.pageX+10).css("top",e.pageY+10).css("display","block").html(jQuery(this).attr("data-tooltip"))}),jQuery("#show_all_parties").click(function(){jQuery("#party_picker .selected").removeClass("selected"),jQuery("#show_all_parties").addClass("selected");for(var e=jQuery("#syria_leaning .fade"),t=0;e.length>t;t++)e[t].setAttribute("class",e[t].getAttribute("class").replace(/\sfade/,""));showing_d_only=!1,showing_r_only=!1,update_count(displayed_leaning)}),jQuery("#show_republicans_only").click(function(){jQuery("#party_picker .selected").removeClass("selected"),jQuery("#show_republicans_only").addClass("selected");for(var e=jQuery("#syria_leaning .fade"),t=0;e.length>t;t++)e[t].setAttribute("class",e[t].getAttribute("class").replace(/\sfade/,""));for(var n=jQuery("#syria_leaning .democratic,#syria_leaning .empty_seat"),t=0;n.length>t;t++)n[t].setAttribute("class",n[t].getAttribute("class")+" fade");showing_r_only=!0,showing_d_only=!1,update_count(displayed_leaning)}),jQuery("#show_democrats_only").click(function(){jQuery("#party_picker .selected").removeClass("selected"),jQuery("#show_democrats_only").addClass("selected");for(var e=jQuery("#syria_leaning .fade"),t=0;e.length>t;t++)e[t].setAttribute("class",e[t].getAttribute("class").replace(/\sfade/,""));for(var n=jQuery("#syria_leaning .republican,#syria_leaning .empty_seat"),t=0;n.length>t;t++)n[t].setAttribute("class",n[t].getAttribute("class")+" fade");showing_d_only=!0,showing_r_only=!1,update_count(displayed_leaning)}),jQuery(document).click(function(){jQuery("svg circle").bind("mousemove",function(e){tooltip_element.css("left",e.pageX+10).css("top",e.pageY+10).css("display","block").html(jQuery(this).attr("data-tooltip"))}),tooltip_element.css("display","none")}),jQuery("svg circle").click(function(e){return jQuery("svg circle").unbind("mouseout"),jQuery("svg circle").unbind("mousemove"),tooltip_element.css("left",e.pageX+10).css("top",e.pageY+10).css("display","block").html(jQuery(this).attr("data-tooltip")),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1})};var cleanup_dataset=function(e){for(var t={D:{yes:{strong:[],weak:[]},no:{strong:[],weak:[]},unknown:[],undecided:[]},R:{yes:{strong:[],weak:[]},no:{strong:[],weak:[]},unknown:[],undecided:[]},I:{yes:{strong:[],weak:[]},no:{strong:[],weak:[]},unknown:[],undecided:[]}},n=0,a=0,o=0,s=0;e.length>s;s++){var r=e[s].lean=e[s].undecided?"undecided":e[s].unknown?"unknown":e[s].no||e[s].leanno?"no":"yes",l=e[s].strength=e[s].undecided||e[s].unknown?"":e[s].no||e[s].yes?"strong":"weak";"D"===e[s].party?n++:"R"===e[s].party?a++:"I"===e[s].party&&o++;var i={name:e[s].member,party:"R"===e[s].party?"Republican":"Democrat",lean:r,strength:l,source:e[s].link};dust.render("tooltip",i,function(e,t){i.tooltip=t}),"undecided"===r||"unknown"===r?t[e[s].party][r].push(i):t[e[s].party][r][l].push(i)}return t},count_whip=function(e){for(var t=0,n=0;seat_fillers.length>n;n++)t=seat_filler[seat_fillers[n]](e,t);update_count(e)},update_count=function(e){showing_d_only||showing_r_only?showing_r_only?(jQuery("#breakdown_no").text(e.R.no.strong.length),jQuery("#breakdown_weak_no").text(e.R.no.weak.length),jQuery("#breakdown_yes").text(e.R.yes.strong.length),jQuery("#breakdown_weak_yes").text(e.R.yes.weak.length),jQuery("#breakdown_neither").text(e.R.unknown.length+e.R.undecided.length)):showing_d_only&&(jQuery("#breakdown_no").text(e.D.no.strong.length),jQuery("#breakdown_weak_no").text(e.D.no.weak.length),jQuery("#breakdown_yes").text(e.D.yes.strong.length),jQuery("#breakdown_weak_yes").text(e.D.yes.weak.length),jQuery("#breakdown_neither").text(e.D.unknown.length+e.R.undecided.length)):(jQuery("#breakdown_no").text(e.D.no.strong.length+e.R.no.strong.length),jQuery("#breakdown_weak_no").text(e.D.no.weak.length+e.R.no.weak.length),jQuery("#breakdown_yes").text(e.D.yes.strong.length+e.R.yes.strong.length),jQuery("#breakdown_weak_yes").text(e.D.yes.weak.length+e.R.yes.weak.length),jQuery("#breakdown_neither").text(e.D.unknown.length+e.D.undecided.length+e.R.unknown.length+e.R.undecided.length))},seat_filler={};seat_filler.add_strong_d_no=function(e,t){for(var n=e.D.no.strong,a=0;n.length>a;a++){var o=document.getElementById("seat"+t);t++,o.setAttribute("class","strongDno "+n[a].name.replace(/\s/,"")+" democratic strong no"+(showing_r_only?" fade":"")),o.setAttribute("data-tooltip",n[a].tooltip)}return t},seat_filler.add_weak_d_no=function(e,t){for(var n=e.D.no.weak,a=0;n.length>a;a++){var o=document.getElementById("seat"+t);t++,o.setAttribute("class","weakDno "+n[a].name.replace(/\s/,"")+" democratic weak no"+(showing_r_only?" fade":"")),o.setAttribute("data-tooltip",n[a].tooltip)}return t},seat_filler.add_d_undecided=function(e,t){for(var n=e.D.undecided,a=0;n.length>a;a++){var o=document.getElementById("seat"+t);t++,o.setAttribute("class","d_undecided "+n[a].name.replace(/\s/,"")+(showing_r_only?" fade":"")+" democratic undecided"),o.setAttribute("data-tooltip",n[a].tooltip)}return t},seat_filler.add_d_unknown=function(e,t){for(var n=e.D.unknown,a=0;n.length>a;a++){var o=document.getElementById("seat"+t);t++,o.setAttribute("class","d_unknown "+n[a].name.replace(/\s/,"")+(showing_r_only?" fade":"")+" democratic unknown"),o.setAttribute("data-tooltip",n[a].tooltip)}return t},seat_filler.add_weak_d_yes=function(e,t){for(var n=e.D.yes.weak,a=0;n.length>a;a++){var o=document.getElementById("seat"+t);t++,o.setAttribute("class","weakDyes "+n[a].name.replace(/\s/,"")+(showing_r_only?" fade":"")+" democratic weak yes"),o.setAttribute("data-tooltip",n[a].tooltip)}return t},seat_filler.add_strong_d_yes=function(e,t){for(var n=e.D.yes.strong,a=0;n.length>a;a++){var o=document.getElementById("seat"+t);o.setAttribute("class","strongDyes "+n[a].name.replace(/\s/,"")+(showing_r_only?" fade":"")+" democratic strong yes"),t++,o.setAttribute("data-tooltip",n[a].tooltip)}return t},seat_filler.add_empty=function(e,t){return document.getElementById("seat"+t).setAttribute("class","empty_seat"+(showing_d_only||showing_r_only?" fade":"")),document.getElementById("seat"+t).setAttribute("data-tooltip","Empty Seat"),t++,document.getElementById("seat"+t).setAttribute("class","empty_seat"+(showing_d_only||showing_r_only?" fade":"")),document.getElementById("seat"+t).setAttribute("data-tooltip","Empty Seat"),t++,t},seat_filler.add_strong_r_yes=function(e,t){for(var n=e.R.yes.strong,a=0;n.length>a;a++){var o=document.getElementById("seat"+t);t++,o.setAttribute("class","strongRyes "+n[a].name.replace(/\s/,"")+(showing_d_only?" fade":"")+" strong republican yes"),o.setAttribute("data-tooltip",n[a].tooltip)}return t},seat_filler.add_weak_r_yes=function(e,t){for(var n=e.R.yes.weak,a=0;n.length>a;a++){var o=document.getElementById("seat"+t);t++,o.setAttribute("class","weakRyes "+n[a].name.replace(/\s/,"")+(showing_d_only?" fade":"")+" weak republican yes"),o.setAttribute("data-tooltip",n[a].tooltip)}return t},seat_filler.add_r_unknown=function(e,t){for(var n=e.R.unknown,a=0;n.length>a;a++){var o=document.getElementById("seat"+t);t++,o.setAttribute("class","r_unknown "+n[a].name.replace(/\s/,"")+(showing_d_only?" fade":"")+" republican unknown"),o.setAttribute("data-tooltip",n[a].tooltip+n[a].lean)}return t},seat_filler.add_r_undecided=function(e,t){for(var n=e.R.undecided,a=0;n.length>a;a++){var o=document.getElementById("seat"+t);t++,o.setAttribute("class","r_undecided "+n[a].name.replace(/\s/,"")+(showing_d_only?" fade":"")+" republican undecided"),o.setAttribute("data-tooltip",n[a].tooltip)}return t},seat_filler.add_weak_r_no=function(e,t){for(var n=e.R.no.weak,a=0;n.length>a;a++){var o=document.getElementById("seat"+t);t++,o.setAttribute("class","weakRno "+n[a].name.replace(/\s/,"")+(showing_d_only?" fade":"")+" weak republican no"),o.setAttribute("data-tooltip",n[a].tooltip)}return t},seat_filler.add_strong_r_no=function(e,t){for(var n=e.R.no.strong,a=0;n.length>a;a++){var o=document.getElementById("seat"+t);t++,o.setAttribute("class","strongRno "+n[a].name.replace(/\s/,"")+(showing_d_only?" fade":"")+" strong republican no"),o.setAttribute("data-tooltip",n[a].tooltip)}return t};