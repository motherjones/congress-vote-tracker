/*! Syria Vote - v0.1.0 - 2013-09-06
* https://github.com/motherjones/syria
* Copyright (c) 2013 Mother Jones Data Desk; Licensed MIT */
"use strict";var current_d=199,current_r=234,current_empty=2,total_seats=435,tooltip_template="     <h3>{member}</h3>     <p>Party Affiliation: {party}</p>     <p>{strength} {lean}</p> ",compiled_tooltip=dust.compile(tooltip_template,"tooltip");dust.loadSource(compiled_tooltip);var tooltip_element=jQuery('<div id="tooltip" style="display: none; position: absolute;"><p>text</p></div>');window.onload=function(){jQuery("svg").before(tooltip_element);var t;Tabletop.init({key:public_spreadsheet_url,callback:function(e){var o=t=cleanup_dataset(e);console.log("current dataset has "+e.length),count_whip(o)},simpleSheet:!0});var e=[];for(var o in sep_5_6pm)e.push(o);e=e[0],console.log("sep 5 dataset has "+sep_5_6pm[e].length);var n=[];for(var o in sep_6_12am)n.push(o);n=n[0],console.log("sep 6 dataset has "+sep_6_12am[n].length);var a=cleanup_dataset(sep_5_6pm[e]),s=cleanup_dataset(sep_6_12am[n]);jQuery("#sep5_6pm").click(function(){count_whip(a)}),jQuery("#sep6_12am").click(function(){count_whip(s)}),jQuery("#current").click(function(){count_whip(t)})};var cleanup_dataset=function(t){for(var e={D:{yes:{strong:[],weak:[]},no:{strong:[],weak:[]},unknown:[],undecided:[]},R:{yes:{strong:[],weak:[]},no:{strong:[],weak:[]},unknown:[],undecided:[]},I:{yes:{strong:[],weak:[]},no:{strong:[],weak:[]},unknown:[],undecided:[]}},o=0,n=0,a=0,s=0;t.length>s;s++){var r=t[s].lean=t[s].undecided?"undecided":t[s].unknown?"unknown":t[s].no||t[s].leanno?"no":"yes",l=t[s].strength=t[s].undecided||t[s].unknown?"":t[s].no||t[s].yes?"strong":"weak";"D"===t[s].party?o++:"R"===t[s].party?n++:"I"===t[s].party&&a++,dust.render("tooltip",t[s],function(e,o){t[s].tooltip=o});var i={name:t[s].member,party:t[s].party,lean:r+l,tooltip:t[s].tooltip};"undecided"===r||"unknown"===r?e[t[s].party][r].push(i):e[t[s].party][r][l].push(i)}return e},count_whip=function(t){for(var e=0,o=t.D.no.strong,n=0;o.length>n;n++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","strongDno "+o[n].name.replace(/\s/,"")),a.setAttribute("data-tooltip",o[n].tooltip)}for(var s=t.D.no.weak,n=0;s.length>n;n++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","weakDno "+s[n].name.replace(/\s/,"")),a.setAttribute("data-tooltip",s[n].tooltip)}for(var r=t.D.undecided,n=0;r.length>n;n++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","d_undecided "+r[n].name.replace(/\s/,"")),a.setAttribute("data-tooltip",r[n].tooltip)}for(var l=t.D.unknown,n=0;l.length>n;n++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","d_unknown "+l[n].name.replace(/\s/,"")),a.setAttribute("data-tooltip",l[n].tooltip)}for(var i=t.D.yes.weak,n=0;i.length>n;n++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","weakDyes "+i[n].name.replace(/\s/,"")),a.setAttribute("data-tooltip",i[n].tooltip)}for(var u=t.D.yes.strong,n=0;u.length>n;n++){var a=document.getElementById("seat"+e);a.setAttribute("class","strongDyes "+e),e++,a.setAttribute("data-tooltip",u[n].tooltip)}document.getElementById("seat199").setAttribute("class","empty_seat"),document.getElementById("seat199").setAttribute("data-tooltip","Empty Seat seat 199"),e++,document.getElementById("seat200").setAttribute("class","empty_seat"),document.getElementById("seat200").setAttribute("data-tooltip","Empty Seat seat 200"),e++;for(var p=t.R.yes.strong,n=0;p.length>n;n++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","strongRyes "+p[n].name.replace(/\s/,"")),a.setAttribute("data-tooltip",p[n].tooltip)}var d=t.R.yes.weak;console.log("weak r "+d.length);for(var n=0;d.length>n;n++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","weakRyes "+d[n].name.replace(/\s/,"")),a.setAttribute("data-tooltip",d[n].tooltip)}var c=y+p.length+d.length,m=t.R.unknown;console.log("r unkown "+m.length);for(var n=0;m.length>n;n++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","r_unknown "+m[n].name.replace(/\s/,"")),a.setAttribute("data-tooltip",m[n].tooltip+m[n].lean)}for(var g=t.R.undecided,n=0;g.length>n;n++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","r_undecided "+g[n].name.replace(/\s/,"")),a.setAttribute("data-tooltip",g[n].tooltip)}for(var y=c+m.length+g.length,v=t.R.no.weak,n=0;v.length>n;n++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","weakRno "+v[n].name.replace(/\s/,"")),a.setAttribute("data-tooltip",v[n].tooltip)}for(var _=t.R.no.strong,n=0;_.length>n;n++){var a=document.getElementById("seat"+e);e++,a.setAttribute("class","strongRno "+_[n].name.replace(/\s/,"")),a.setAttribute("data-tooltip",_[n].tooltip)}jQuery("svg circle").bind("mouseout",function(){tooltip_element.css("display","none")}),jQuery("svg circle").bind("mousemove",function(t){tooltip_element.css("left",t.pageX+10).css("top",t.pageY+10).css("display","block").html(jQuery(this).attr("data-tooltip"))})};